---
layout: article
title: 섹션 9. 파이프와 작업제어
tags: [Linux]
key: 20230221-shell_009
---

{% include googlead.html %}

---

> 리눅스 서버를 자동화하여 관리하기 위한 쉘 스크립트(Shell Script) 심화 강좌를 정리합니다.  
> 출처 : inflearn  

## 1. 파이프

> named pipe 나 fifo 라는 명칭으로 불리움
> 파이프에는 읽기 끝과 쓰기 끝이 있습니다. 파이프의 쓰기 쪽에 기록된 데이터는 파이프의 읽기 쪽에서 읽을 수 있습니다.
> 프로세스(echo)가 파이프에 쓰기를 시도하는 경우, 반대쪽 프로세스에서 파이프에서 충분한 데이터를 읽을 때까지는 쓰기 동작이 완료되지 못하고 echo 명령은 블록(block)됩니다.

```bash
SHKIM:/home/shkim$ pwd
/home/shkim
SHKIM:/home/shkim$ mknod /tmp/mypipe p
SHKIM:/home/shkim$ echo hello world >/tmp/mypipe # 파이프에 쓰기동작
|
```

> 새로운 터미널을 실행해 mypipe 파일의 상태를 확인 합니다.
> 파이프에서 읽기 동작을 마친 후에는 파이프는 비워짐.

```bash
SHKIM:/home/shkim$ ls -l /tmp/mypipe 
prw-r--r-- 1 shkim admin 0  2월 22 23:39 /tmp/mypipe
SHKIM:/home/shkim$ cat /tmp/mypipe # 파이프에서 읽기 동작
hello world
SHKIM:/home/shkim$ 
```

```bash
SHKIM:/home/shkim$ cat hello.txt | more # unnamed pipe
hello

# pipe를 통한 처리 흐름
SHKIM:/home/shkim$ find . -name "*.o" -print0 | xargs -0 rm -rf
```

## 2. 프로세스 대체

> comm : 두개의 비교 대상 디렉토리의 차이점을 확인할 때 유용한 명령어
> 프로세스 대체(command substitution)<(명령어...)

```bash
SHKIM:/home/shkim/edu/shell_cmd$ ls -R ./images
./images:
Balloon.jpg  Candy.jpg  glob.gif  settings_down.JPG  settings_up.JPG  shadingimage.tiff  smaller.tiff

SHKIM:/home/shkim/edu/shell_cmd$ ls -R ./images_mirror/
./images_mirror/:
Balloon.jpg  glob.gif  settings_down.png  settings_up.png  shadingimage.tiff  smaller.tiff
```

> comm 옵션은 1,2,3 이 있다.
> 2 : 두개의 내용을 비교하되, 파일 2에 있는 것은 출력하지 않는다
> 3 : 두개의 내용을 비교하되, 2개의 파일내에 공통적으로 존재하는 라인은 출력하지 않는다.

```bash
SHKIM:/home/shkim/edu/shell_cmd$ comm -23 <(ls -R /home/shkim/edu/shell_cmd/images|sort) <(ls -R /home/shkim/edu/shell_cmd/images_mirror/|sort)
/home/shkim/edu/shell_cmd/images:
Candy.jpg
settings_down.JPG
settings_up.JPG
```

> jpg 확장자의 파일의 갯수 확인하기.

```bash
SHKIM:/home/shkim/edu/shell_cmd/images$ i=0
SHKIM:/home/shkim/edu/shell_cmd/images$ pwd
/home/shkim/edu/shell_cmd/images
SHKIM:/home/shkim/edu/shell_cmd/images$ ls
Balloon.jpg  Candy.jpg  glob.gif  shadingimage.tiff  smaller.tiff
SHKIM:/home/shkim/edu/shell_cmd/images$ while read file; do
> ((i++))
> done < <(find . -type f -name "*.jpg")
SHKIM:/home/shkim/edu/shell_cmd/images$ 
SHKIM:/home/shkim/edu/shell_cmd/images$ echo $i
2
```


## 3. 서브쉘

## 4. 함수

## 5. 명령어(shift)

## 6. source 와 bashrc

## 7. 작업제어

## 8. 디버깅

## 9. 명령어(cron)
